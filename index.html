<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Learn with Ms. ThÃºy</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700;800;900&family=Caveat:wght@700&display=swap" rel="stylesheet"/>
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    RESET & VARIABLES (GIá»® NGUYÃŠN GIAO DIá»†N Gá»C)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --sky:     #a8d8f0;
  --lavender:#c9b8f5;
  --rose:    #f5b8d0;
  --mint:    #b8f0e0;
  --peach:   #f5d5b8;
  --cream:   #fdf6f0;
  --bg-from: #e8f4fd;
  --bg-to:   #f5e8fa;
  --glass-bg:     rgba(255,255,255,0.58);
  --glass-border: rgba(255,255,255,0.85);
  --glass-shadow: 0 8px 32px rgba(150,120,200,0.13);
  --text-dark:  #2d2640;
  --text-mid:   #6b5f8a;
  --text-light: #a898c8;
  --sidebar-w: 268px;
  --header-h:  62px;
  --correct-bg:  rgba(100,220,150,0.18);
  --correct-brd: #4caf82;
  --wrong-bg:    rgba(255,100,100,0.14);
  --wrong-brd:   #e05c5c;
  --accent-grad: linear-gradient(135deg, var(--sky), var(--lavender), var(--rose));
  --btn-grad:    linear-gradient(135deg, #8ec5fc 0%, #c9b8f5 50%, #f5b8d0 100%);
}

html, body {
  height: 100%; overflow: hidden;
  font-family: 'Nunito', sans-serif;
  color: var(--text-dark);
  background: linear-gradient(135deg, var(--bg-from) 0%, var(--bg-to) 100%);
}

body::before, body::after {
  content: ''; position: fixed; border-radius: 50%;
  filter: blur(80px); pointer-events: none; z-index: 0; opacity: 0.5;
}
body::before {
  width: 600px; height: 600px; top: -200px; left: -150px;
  background: radial-gradient(circle, #c9b8f5 0%, transparent 70%);
  animation: blobFloat 12s ease-in-out infinite alternate;
}
body::after {
  width: 500px; height: 500px; bottom: -150px; right: -100px;
  background: radial-gradient(circle, #f5b8d0 0%, transparent 70%);
  animation: blobFloat 9s ease-in-out infinite alternate-reverse;
}
@keyframes blobFloat {
  0%   { transform: translate(0,0) scale(1); }
  100% { transform: translate(40px, 30px) scale(1.1); }
}

#app {
  position: relative; z-index: 1;
  display: flex; flex-direction: column;
  height: 100vh; overflow: hidden;
}

header {
  height: var(--header-h); flex-shrink: 0;
  display: flex; align-items: center; gap: 14px;
  padding: 0 22px;
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  border-bottom: 1.5px solid var(--glass-border);
  box-shadow: 0 2px 20px rgba(150,120,200,0.1);
}

#sidebar-toggle {
  width: 36px; height: 36px; border-radius: 10px; flex-shrink: 0;
  border: 1.5px solid rgba(160,130,220,0.25);
  background: rgba(255,255,255,0.6);
  cursor: pointer; display: flex; align-items: center; justify-content: center;
  font-size: 16px; transition: all 0.2s;
  box-shadow: 0 2px 8px rgba(150,120,200,0.1);
}

.header-logo {
  font-family: 'Caveat', cursive;
  font-size: 26px; font-weight: 700;
  background: linear-gradient(135deg, #7bb8e8 0%, #a87dd6 45%, #e07ab0 100%);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  letter-spacing: 0.5px;
}

#header-unit {
  margin-left: auto;
  font-size: 12.5px; font-weight: 600;
  color: var(--text-mid);
  background: rgba(200,180,255,0.2);
  border: 1px solid rgba(180,150,240,0.3);
  padding: 5px 14px; border-radius: 20px;
  max-width: 280px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}

#body-row { flex: 1; display: flex; overflow: hidden; }

#sidebar {
  width: var(--sidebar-w); flex-shrink: 0;
  display: flex; flex-direction: column;
  background: rgba(255,255,255,0.52);
  backdrop-filter: blur(24px);
  border-right: 1.5px solid var(--glass-border);
  overflow: hidden;
  transition: width 0.36s cubic-bezier(.4,0,.2,1), opacity 0.3s;
}
#sidebar.closed { width: 0; opacity: 0; }

.sb-title {
  padding: 18px 20px 10px;
  font-size: 10px; letter-spacing: 3px; text-transform: uppercase;
  color: var(--text-light); font-weight: 700;
  border-bottom: 1px solid rgba(200,180,240,0.25);
}

#unit-list { flex: 1; overflow-y: auto; padding: 10px 10px 20px; }

.unit-btn {
  width: 100%; text-align: left;
  padding: 11px 14px; border-radius: 12px;
  border: 1.5px solid transparent;
  background: none; cursor: pointer;
  font-family: 'Nunito', sans-serif;
  font-size: 13px; font-weight: 600;
  color: var(--text-mid);
  display: flex; align-items: center; gap: 10px;
  margin-bottom: 4px; transition: all 0.2s;
}
.unit-btn:hover { background: rgba(200,180,255,0.2); }
.unit-btn.active {
  background: rgba(200,180,255,0.28);
  border-color: rgba(180,150,240,0.45);
  color: var(--text-dark);
}
.unit-pill {
  width: 24px; height: 24px; flex-shrink: 0;
  border-radius: 8px; font-size: 11px; font-weight: 800;
  display: flex; align-items: center; justify-content: center;
  background: var(--btn-grad); color: #fff;
}

#workspace { flex: 1; display: flex; overflow: hidden; position: relative; }
#col-video { display: flex; flex-direction: column; min-width: 280px; overflow: hidden; padding: 18px 0 18px 18px; }

.panel-card {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  border: 1.5px solid var(--glass-border);
  border-radius: 18px;
  box-shadow: var(--glass-shadow);
  overflow: hidden;
  flex: 1; display: flex; flex-direction: column;
}

.panel-header {
  padding: 13px 18px; font-size: 12px; font-weight: 700; letter-spacing: 1.5px; text-transform: uppercase;
  color: var(--text-mid); border-bottom: 1px solid rgba(200,180,240,0.3);
  display: flex; align-items: center; gap: 8px;
}
.panel-dot { width: 8px; height: 8px; border-radius: 50%; }
.panel-dot.sky { background: var(--sky); }
.panel-dot.rose { background: var(--rose); }

.video-wrapper { flex: 1; position: relative; background: #1a1530; display: flex; align-items: center; justify-content: center; }

#splitter {
  width: 10px; flex-shrink: 0; cursor: col-resize;
  display: flex; align-items: center; justify-content: center; z-index: 10;
}
#splitter::before {
  content: ''; width: 4px; height: 48px; border-radius: 2px;
  background: linear-gradient(180deg, var(--sky), var(--lavender), var(--rose));
  opacity: 0.6; transition: 0.2s;
}

#col-transcript { display: flex; flex-direction: column; min-width: 300px; overflow: hidden; padding: 18px 18px 18px 0; flex: 1; }
.transcript-scroll { flex: 1; overflow-y: auto; padding: 16px 18px; scroll-behavior: smooth; }

.t-line {
  padding: 10px 14px; border-radius: 12px; font-size: 15px; line-height: 2.2;
  margin-bottom: 6px; border: 1.5px solid transparent; transition: 0.3s; color: var(--text-mid);
}
.t-line.active {
  background: rgba(200,180,255,0.22); border-color: rgba(180,150,240,0.4);
  color: var(--text-dark); box-shadow: 0 2px 16px rgba(150,120,200,0.12);
}

.blank-wrap { display: inline-flex; align-items: center; gap: 3px; vertical-align: middle; margin: 0 2px; }
.blank-idx { font-size: 9px; font-weight: 800; background: linear-gradient(135deg, var(--sky), var(--lavender)); color: #fff; border-radius: 4px; padding: 1px 4px; }
.blank-input {
  border: none; outline: none; border-bottom: 2px solid rgba(180,150,240,0.5);
  background: rgba(230,220,255,0.25); border-radius: 6px 6px 0 0;
  font-family: 'Nunito', sans-serif; font-size: 14px; font-weight: 700;
  color: var(--text-dark); padding: 2px 8px; text-align: center; min-width: 70px;
}
.blank-input.correct { border-color: var(--correct-brd); background: var(--correct-bg); color: #2e7d4f; }
.blank-input.wrong { border-color: var(--wrong-brd); background: var(--wrong-bg); color: #c0392b; }
.ans-hint { font-size: 12px; font-weight: 700; color: var(--wrong-brd); background: rgba(255,100,100,0.1); padding: 1px 7px; border-radius: 5px; }

.action-bar { padding: 14px 18px 16px; border-top: 1px solid rgba(200,180,240,0.3); display: flex; align-items: center; gap: 10px; }
.btn-check { padding: 10px 26px; border: none; border-radius: 50px; cursor: pointer; font-weight: 800; background: var(--btn-grad); color: #fff; }
.btn-reset { padding: 10px 20px; border-radius: 50px; border: 1.5px solid rgba(180,150,240,0.35); background: #fff; cursor: pointer; }

#loading {
  position: fixed; inset: 0; z-index: 999;
  background: linear-gradient(135deg, var(--bg-from), var(--bg-to));
  display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 18px;
}
#loading.hidden { opacity: 0; pointer-events: none; }

@media (max-width: 700px) {
  #workspace { flex-direction: column; }
  #splitter { display: none; }
  #col-video { padding: 10px; width: 100% !important; height: 300px; }
}
</style>
</head>
<body>

<div id="loading">
  <div class="load-logo">Learn with Ms. ThÃºy ğŸŒ¸</div>
  <div class="load-bar"><div class="load-bar-fill"></div></div>
</div>

<div id="app">
  <header>
    <button id="sidebar-toggle" onclick="toggleSidebar()">â˜°</button>
    <div class="header-logo">Learn with Ms. ThÃºy <span>ğŸŒ¸</span></div>
    <div id="header-unit">Choose a unit to begin</div>
  </header>

  <div id="body-row">
    <nav id="sidebar">
      <div class="sb-title">ğŸ“š Units</div>
      <div id="unit-list"></div>
    </nav>

    <div id="workspace">
      <div id="col-video" style="width:50%">
        <div class="panel-card">
          <div class="panel-header"><div class="panel-dot sky"></div> Video Player</div>
          <div class="video-wrapper">
            <div class="video-placeholder" id="video-placeholder">
              <div class="icon">ğŸ¬</div><div>Select a unit to load video</div>
            </div>
            <div id="yt-player-container" style="display:none;width:100%;height:100%;">
                <div id="yt-player"></div>
            </div>
          </div>
        </div>
      </div>

      <div id="splitter"></div>

      <div id="col-transcript">
        <div class="panel-card">
          <div class="panel-header"><div class="panel-dot rose"></div> Fill in the Blanks</div>
          <div class="transcript-scroll" id="transcript-scroll">
            <div style="color:var(--text-light);text-align:center;padding:40px;">Choose a unit ğŸ‘ˆ</div>
          </div>
          <div class="action-bar">
            <button class="btn-check" onclick="checkResults()">âœ… Check Results</button>
            <button class="btn-reset" onclick="resetBlanks()">â†º Reset</button>
            <div id="score-area"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>

<script>
// STATE & INIT 
let units = [];
let currentUnit = null;
let ytPlayer = null;
let ytReady = false;
let syncInterval = null;
let answers = [];

async function init() {
  try {
    const res = await fetch('data.json');
    const data = await res.json();
    units = data.units;
    renderSidebar();
  } catch(e) { console.error('Data error:', e); }
  setTimeout(() => document.getElementById('loading').classList.add('hidden'), 900);
}

function renderSidebar() {
  document.getElementById('unit-list').innerHTML = units.map((u,i) => `
    <button class="unit-btn" id="ubtn-${u.id}" onclick="loadUnit(${i})">
      <div class="unit-pill">${u.id}</div><span>${u.title}</span>
    </button>`).join('');
}

function toggleSidebar() {
  document.getElementById('sidebar').classList.toggle('closed');
}

// VIDEO & TRANSCRIPT LOGIC 
function loadUnit(idx) {
  const u = units[idx];
  currentUnit = u;
  document.querySelectorAll('.unit-btn').forEach(b => b.classList.remove('active'));
  document.getElementById(`ubtn-${u.id}`).classList.add('active');
  document.getElementById('header-unit').textContent = u.title;
  
  renderTranscript(u.transcript);
  loadYouTube(u.youtube_id);
  document.getElementById('score-area').innerHTML = '';
}

function onYouTubeIframeAPIReady() { ytReady = true; }

function loadYouTube(videoId) {
  if (!ytReady) return;
  document.getElementById('video-placeholder').style.display = 'none';
  document.getElementById('yt-player-container').style.display = 'block';

  if (ytPlayer && ytPlayer.loadVideoById) {
    ytPlayer.loadVideoById(videoId);
  } else {
    ytPlayer = new YT.Player('yt-player', {
      videoId: videoId,
      width: '100%', height: '100%',
      playerVars: { 'autoplay': 1, 'rel': 0, 'modestbranding': 1 },
      events: { 'onStateChange': onPlayerStateChange }
    });
  }
}

function onPlayerStateChange(e) {
  if (e.data === YT.PlayerState.PLAYING) {
    syncInterval = setInterval(() => {
      syncTranscript(ytPlayer.getCurrentTime());
    }, 300);
  } else {
    clearInterval(syncInterval);
  }
}

function renderTranscript(lines) {
  answers = [];
  let bIdx = 0;
  const scroll = document.getElementById('transcript-scroll');
  
  // Sá»­a Regex: [^\]]+ Ä‘á»ƒ nháº­n diá»‡n chÃ­nh xÃ¡c má»i kÃ½ tá»± bÃªn trong dáº¥u ngoáº·c 
  const html = lines.map((line, li) => {
    const lineHtml = line.text.replace(/\[([^\]]+)\]/g, (_, word) => {
      bIdx++;
      answers.push({ num: bIdx, word });
      const w = Math.max(80, word.length * 12);
      return `<span class="blank-wrap"><span class="blank-idx">${bIdx}</span>
              <input class="blank-input" id="b${bIdx}" style="width:${w}px" autocomplete="off"></span>`;
    });
    return `<div class="t-line" id="tline-${li}">${lineHtml}</div>`;
  }).join('');
  scroll.innerHTML = html;
}

function syncTranscript(time) {
  if (!currentUnit) return;
  currentUnit.transcript.forEach((line, i) => {
    const el = document.getElementById(`tline-${i}`);
    if (time >= line.start && time < line.end) {
      if (!el.classList.contains('active')) {
        el.classList.add('active');
        el.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    } else { el.classList.remove('active'); }
  });
}

// CHECK RESULTS 
function checkResults() {
  let correct = 0;
  answers.forEach(({ num, word }) => {
    const inp = document.getElementById(`b${num}`);
    const val = inp.value.trim().toLowerCase();
    const wrap = inp.parentNode;
    if (wrap.querySelector('.ans-hint')) wrap.querySelector('.ans-hint').remove();

    if (val === word.toLowerCase()) {
      inp.className = 'blank-input correct';
      correct++;
    } else {
      inp.className = 'blank-input wrong';
      const hint = document.createElement('span');
      hint.className = 'ans-hint';
      hint.textContent = `(${word})`;
      wrap.appendChild(hint);
    }
  });
  const total = answers.length;
  document.getElementById('score-area').innerHTML = `<div class="score-pill">ğŸ† ${correct}/${total}</div>`;
}

function resetBlanks() {
  document.querySelectorAll('.blank-input').forEach(i => {
    i.value = ''; i.className = 'blank-input';
  });
  document.querySelectorAll('.ans-hint').forEach(h => h.remove());
  document.getElementById('score-area').innerHTML = '';
}

// SPLITTER LOGIC
(function() {
  const splitter = document.getElementById('splitter');
  const colVideo = document.getElementById('col-video');
  let isDragging = false;
  splitter.onmousedown = () => isDragging = true;
  document.onmousemove = (e) => {
    if (!isDragging) return;
    let w = Math.max(300, Math.min(window.innerWidth - 400, e.clientX));
    colVideo.style.width = w + 'px';
  };
  document.onmouseup = () => isDragging = false;
})();

init();
</script>
</body>
</html>
